{% extends 'admin/base.html' %}
{% block title %}Настройки — AI Router{% endblock %}
{% block content %}
<h2>Настройки</h2>
<p>API-ключи провайдеров теперь настраиваются на странице <a href="{{ url_for('admin.manage_providers') }}">«Поставщики»</a>.</p>
<form method="post">
  <label>Токен Telegram-бота
    <input type="text" name="telegram_bot_token" value="{{ settings.get('telegram_bot_token', '') }}">
  </label>
  <label>URL вебхука
    <input type="text" name="webhook_url" value="{{ settings.get('webhook_url', '') }}">
    <small class="hint">Webhook требует полный HTTPS-адрес (например, https://example.com/telegram-hook).</small>
  </label>
  <label>Путь вебхука
    <input type="text" name="webhook_path" value="{{ settings.get('webhook_path', '') }}" placeholder="/bot/webhook">
    <small class="hint">Относительный путь, который будет привязан к Flask. Оставьте пустым, чтобы использовать путь из URL.</small>
  </label>
  <label>Секрет вебхука
    <input type="text" name="webhook_secret" value="{{ settings.get('webhook_secret', '') }}">
  </label>
  <label>Режим по умолчанию
    <input type="text" name="default_mode" value="{{ settings.get('default_mode', 'default') }}">
  </label>
  <label>Лимит токенов на диалог
    <input type="number" name="dialog_token_limit" min="0" value="{{ settings.get('dialog_token_limit', '') }}" placeholder="0 — без ограничений">
  </label>
  <label>Активная модель
    <select name="active_model_id">
      <option value="">-- не выбрано --</option>
      {% for model in models %}
      <option value="{{ model.id }}" {% if settings.get('active_model_id') == model.id|string %}selected{% endif %}>{{ model.name }} ({{ model.model }})</option>
      {% endfor %}
    </select>
  </label>
  <label>Получатели уведомлений об ошибках (user_id через запятую или пробел)
    <input type="text" name="error_notification_user_ids" value="{{ settings.get('error_notification_user_ids', '') }}" placeholder="Например: 12345, 67890">
  </label>
  <label>Сообщение приостановки работы бота
    <textarea name="bot_pause_message" placeholder="Текст, который увидят пользователи при приостановке. Поддерживается HTML.">{{ settings.get('bot_pause_message', '') }}</textarea>
  </label>
  <button class="btn" type="submit">Сохранить</button>
</form>
{% endblock %}
