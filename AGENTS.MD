# Обзор проекта ai_router

Приложение на **Python/Flask** для доступа к LLM через **OpenAI API**.  
Состоит из:
- **Телеграм-бота** — основной пользовательский интерфейс для общения с моделью.
- **Веб-интерфейса администратора** — панель управления и мониторинга.
- Общих сервисов и моделей данных.

## Структура проекта
- web/ — логика веб-интерфейса (Flask Blueprints, роуты, шаблоны).
- bot/ — функционал телеграм-бота (обработчики команд, клавиатуры, сценарии диалога).
- services/ — универсальные модули (работа с API, утилиты, бизнес-логика).
- models/ — ORM-модели SQLAlchemy.

ai_router/
│
├── app/                # Основное приложение
│   ├── bot/            # Логика телеграм-бота
│   ├── models/         # ORM-модели SQLAlchemy
│   ├── services/       # Общие сервисы и утилиты
│   ├── web/            # Веб-интерфейс (админка)
│   └── __init__.py     # Инициализация приложения
└── run.py          # Точка входа (Flask запуск)

## Функционал

### Веб-интерфейс администратора (web/)
- Мониторинг пользователей (просмотр активности, обращения к боту и ответы, расход токенов, диалоги).
- Настройки интеграции с OpenAI API (API-ключи, параметры моделей). Возможность добавить несколько моделей и переключаться между ними.
- Просмотр логов запросов и ответов.
- Простая система статистики с выбором периода: кол-во запросов, активные пользователи, расход токенов.
- url-path для админки: `/admin`
- Указание API ключа бота в настройках админки.
- Запуск телеграм-бота из админки в pooling (кнопка "Запустить бота").
- Запуск телеграм-бота из админки в webhook (кнопка "Запустить бота в webhook").

### Телеграм-бот (bot/)
- Отправка запросов к LLM через OpenAI API.
- Поддержка базовых команд (/start, /help).
- Поддержка диалогового режима: бот запоминает контекст переписки в рамках диалога, который прекращается кнопкой `Начать новый диалог` в inline-клавиатуре.
- Возможность управления подписками (free/paid) — планируется на будущее.
- Все обращения к боту логируются в БД с привязкой к пользователю и диалогу.

## Технологии и зависимости
- Flask — веб-фреймворк.
- SQLAlchemy — ORM для работы с БД.
- Requests — HTTP-запросы.
- OpenAI — доступ к LLM.
- Telebot (pyTelegramBotAPI) — работа с Telegram Bot API.

## Запуск проекта
flask run

## Стандарты разработки
- Следовать PEP8.
- Для всех функций — подробные docstrings (описание назначения, аргументов и возвращаемых значений).
- Использовать logging вместо print.
- SQLAlchemy модели определяются в папке models/.
- Общую бизнес-логику выносить в `services/`, избегать дублирования кода.
- Сложный функционал выностиь в отдельные модули в соответствующих разделах текущей структуры (`bot/`, `web/`, `services/`)

## Хранилище данных
- Простая SQL-база (например, SQLite) на этапе разработки.

## Дополнительно
- Минимизировать глобальные переменные.
- Все новые функции должны сопровождаться комментариями для агентов.
- В админке предусмотреть API-эндпоинты для управления настройками.
- В боте предусмотреть graceful handling ошибок (например, при недоступности OpenAI API).
- **Разбивай большие файлы на несколько логичных модулей с понятной структурой**, сохраняй поведение и совместимость, обновляй импорты
